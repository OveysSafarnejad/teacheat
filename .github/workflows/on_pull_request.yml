---
name: Pull request validation

on: 
  pull_request: 
    branches:    
      - development
       
jobs:
    create-envfile:
      runs-on: ubuntu-latest
      steps:
        - name: Make envfile
          uses: SpicyPizza/create-envfile@v1.3
          with:
            envkey_DB_PORT: ${{ secrets.DB_PORT }}
            directory: ../../
            file_name: .env
            fail_on_empty: false


    welcome: # just an id for the job
        name: Welcome
        runs-on: ubuntu-20.04
        steps:
            - name: "Welcome step"
              run: echo "Hello form first job :)"

    test:
        name: Application tests
        runs-on: ubuntu-20.04
        steps:

          - name: Checkout
            uses: actions/checkout@v2

          - name: Tests
            run: docker-compose -f dev.compose.yml run --rm app sh -c "python manage.py test"

    lint:
        name: Lint
        runs-on: ubuntu-20.04
        steps:
          - name: Checkout
            uses: actions/checkout@v2
          
          - name: Lint
            run: docker-compose -f dev.compose.yml run --rm app sh -c "flake8"